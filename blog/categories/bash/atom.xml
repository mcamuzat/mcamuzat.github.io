<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Bash | Mon blog perso.]]></title>
  <link href="http://mcamuzat.github.io/blog/categories/bash/atom.xml" rel="self"/>
  <link href="http://mcamuzat.github.io/"/>
  <updated>2015-11-08T22:25:06+01:00</updated>
  <id>http://mcamuzat.github.io/</id>
  <author>
    <name><![CDATA[mcamuzat]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Faire Des Jointures Sur Des Fichiers Csv]]></title>
    <link href="http://mcamuzat.github.io/blog/2015/11/08/faire-des-jointures-sur-des-fichiers-csv/"/>
    <updated>2015-11-08T20:27:16+01:00</updated>
    <id>http://mcamuzat.github.io/blog/2015/11/08/faire-des-jointures-sur-des-fichiers-csv</id>
    <content type="html"><![CDATA[<h2>Introduction</h2>

<p>Un problème que j&#8217;ai eu au travail.</p>

<p>Soit les deux fichiers suivants csv suivant</p>

<pre><code>ID_1,Noms1,Personne1
ID_2,Noms2,Personne1
ID_2,Noms2,Personne2
ID_3,Noms3,Personne1
ID_5,Noms5,Personne5
</code></pre>

<pre><code>SIRET1,Adresse1,Noms1Annuaire,ID_1
SIRET2,Adresse2,Noms2Annuaire,ID_2
SIRET3,Adresse3,Noms3Annuaire,ID_3
SIRET4,Adresse4,Noms4Annuaire,ID_4
</code></pre>

<p>Je souhaite faire un merge de ces deux csv. Comment faire ?</p>

<p>En solution 1 j&#8217;ai pensé.</p>

<ul>
<li>Créer une table temporaire</li>
<li>dumper les deux fichiers</li>
<li>faire un jointure sql</li>
<li>faire un export</li>
</ul>


<p>Et puis je me suis souvenu de la commande <code>join</code></p>

<p>Voici la commande que j&#8217;ai utilisé</p>

<pre><code class="sh">join -11 -24 file1.csv file2.csv  -t,
</code></pre>

<p>Voici le détail de la commande</p>

<ul>
<li><code>-11</code> <code>-24</code> faire une jointure entre la colonne <strong>1</strong> du <code>file1.csv</code> et la colonne <strong>4</strong> du <code>file2.csv</code></li>
<li><code>-t,</code> définie le séparateur dans le fichier ici c&#8217;est un <code>csv</code> <strong>C</strong>omma <strong>S</strong>epared <strong>V</strong>alue, donc le séparateur est <code>,</code></li>
</ul>


<p>Voici le résultat
<code>
ID_1,Noms1,Personne1,SIRET1,Adresse1,Noms1Annuaire
ID_2,Noms2,Personne1,SIRET2,Adresse2,Noms2Annuaire
ID_2,Noms2,Personne2,SIRET2,Adresse2,Noms2Annuaire
ID_3,Noms3,Personne1,SIRET3,Adresse3,Noms3Annuaire
</code></p>

<p>C&#8217;est une jointure classique <code>ID_5</code> n&#8217;apparait pas dans le résultats pas plus que <code>Adresse4</code></p>

<h2>Faire un select</h2>

<p>On précise les colonnes que l&#8217;on souhaite avec l&#8217;option <code>-o</code></p>

<pre><code>join -11 -24 file1.txt file2.txt  -t, -o1.2,2.1
</code></pre>

<p><code>-o1.2,2.1</code> la colonne <strong>2</strong> du <code>file1.csv</code> et la colonne <strong>1</strong> du <code>file2.csv</code></p>

<pre><code>Noms1,SIRET1
Noms2,SIRET2
Noms2,SIRET2
Noms3,SIRET3
</code></pre>

<h2>Left-join et Right Join</h2>

<p>C&#8217;est possible à émuler avec l&#8217;option <code>-a</code> et <code>-e</code> <code>-a</code> affiche le fichier <strong>1</strong> ou <strong>2</strong>  même s&#8217;il n&#8217;y a pas de jointure et  et <code>-e</code>  la valeur par défaut à l&#8217;affichage</p>

<p>deux possibilités</p>

<pre><code class="sh"># Left-join
join -11 -24 file1.txt file2.txt  -t, -o1.2,2.1,2.2 -a 1 -e NULL
</code></pre>

<pre><code class="">Noms1,SIRET1,Adresse1
Noms2,SIRET2,Adresse2
Noms2,SIRET2,Adresse2
Noms3,SIRET3,Adresse3
Noms5,NULL,NULL
</code></pre>

<pre><code class="sh"># Right-join
join -11 -24 file1.txt file2.txt  -t, -o1.2,2.1,2.2 -a 2 -e NULL
</code></pre>

<pre><code>Noms1,SIRET1,Adresse1
Noms2,SIRET2,Adresse2
Noms2,SIRET2,Adresse2
Noms3,SIRET3,Adresse3
NULL,SIRET4,Adresse4
</code></pre>

<h2>Conclusion</h2>

<p>Si un jour vous avez besoin de merger deux fichiers sans forcement sortir un script complexe, penser à linux.</p>

<p>Pour le csv et PHP, c&#8217;est inclus dans l&#8217;instruction <code>fgetcsv</code> mais ce n&#8217;est pas la joie, la librairie suivante <a href="http://csv.thephpleague.com/">thephpleague/csv</a> rend cela nettement plus agréable.</p>
]]></content>
  </entry>
  
</feed>

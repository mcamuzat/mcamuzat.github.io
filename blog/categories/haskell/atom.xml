<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: haskell | Journal d'un panda qui code]]></title>
  <link href="http://mcamuzat.github.io/blog/categories/haskell/atom.xml" rel="self"/>
  <link href="http://mcamuzat.github.io/"/>
  <updated>2016-01-18T22:08:41+01:00</updated>
  <id>http://mcamuzat.github.io/</id>
  <author>
    <name><![CDATA[mcamuzat]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Je joue donc je programme 3]]></title>
    <link href="http://mcamuzat.github.io/blog/2016/01/18/je-joue-donc-je-programme-3/"/>
    <updated>2016-01-18T20:25:01+01:00</updated>
    <id>http://mcamuzat.github.io/blog/2016/01/18/je-joue-donc-je-programme-3</id>
    <content type="html"><![CDATA[<p>Nous continuons à la recherche de soft donc le but du jeux est d&#8217;apprendre à programmer.</p>

<p><img class="center" src="/images/climurder.png" width="600" height="488" title="&lsquo;Screenshot du dépot CLmurder&rsquo; &lsquo;Screenshot de cli murder&rsquo;" ></p>

<!--more-->


<h2>Les Capture The Flag /Wargame.</h2>

<p>Le but ici est de s&#8217;introduire le premier dans un programme(via connection ssh, iso) et de capturer le drapeau. C&#8217;est un concours et un peu un jeux de piste. On distingue deux types</p>

<ul>
<li><p>les CTF. c&#8217;est un jeu avec une date de début et une date de fin. Je n&#8217;ai jamais participé à ce genre d&#8217;évènement.</p>

<ul>
<li>Actualité <a href="https://ctftime.org/">CTFTime</a></li>
<li><a href="http://en.wikipedia.org/wiki/Capture_the_flag#Computer_security">wikipedia</a></li>
<li>Débuter : <a href="https://www.endgame.com/blog/how-get-started-ctf">How to Get Started in CTF </a> et <a href="https://trailofbits.github.io/ctf/">CTF Field Guide</a></li>
<li>Une liste <a href="https://github.com/apsdehal/awesome-ctf">complète</a></li>
</ul>
</li>
<li><p>Quand on peux rentrer à n&#8217;importe quelle moment on parle de Wargame.</p>

<ul>
<li><a href="http://smashthestack.org/">SmashTheStack</a></li>
<li><a href="http://overthewire.org/wargames/">OverTheWire</a> Le premier challenge <a href="http://overthewire.org/wargames/bandit/">Bandit</a> est vraiment pour un débutant (<strong>Moi!!</strong>)</li>
<li><a href="https://exploit-exercises.com/">Exploit Exercises</a> Les Isos sont téléchargeables</li>
</ul>
</li>
</ul>


<p>Il y a plein de techniques  j&#8217;avoue que je connais assez peu, j&#8217;ai un peu joué avec la backtrack (maintenant connue sur le nom de <a href="https://www.kali.org/">Khali-Linux</a>)</p>

<h2>Xss-Game</h2>

<p>Pour apprendres les failles XSS , C&#8217;est google qui a fais le site suivant</p>

<ul>
<li><a href="https://xss-game.appspot.com/">XSS Game</a></li>
</ul>


<h2>Les concours</h2>

<p>Je suis beaucoup sur <a href="http://www.codewars.com">Codewars</a>. La présentation est clean..</p>

<p>Mais il existe une énorme quantité de site dans le même genre.</p>

<ul>
<li><a href="http://projecteuler.net">Le plus connus le projet Euler</a></li>
<li><a href="http://www.codechef.com">Code Chef</a></li>
<li><a href="http://codeforces.com">Codeforces</a></li>
<li><a href="http://www.codewars.com">Codewars</a></li>
<li><a href="http://eudyptula-challenge.org">Eudyptula Challenge</a>(Kernel Linux)</li>
<li><a href="https://code.google.com/codejam/contests.html">Google Code Jam</a></li>
<li><a href="https://www.hackerrank.com">HackerRank</a></li>
<li><a href="http://ioccc.org">International Obfuscated C Code Contest</a> le code le plus obscure possible..</li>
<li><a href="http://ipsc.ksp.sk">Internet Problem Solving Contest</a></li>
<li><a href="http://www.kaggle.com/competitions">Kaggle</a> (ce sont ici des vrais jeux de données)</li>
<li><a href="http://www.teamleada.com" title="">Leada</a> cours en lignes..</li>
<li><a href="http://community.topcoder.com/tc">Top Coder</a> Il y a des récompenses pour certains challenges.</li>
<li><a href="https://www.codeeval.com">CodeEval</a> Si vous cherchez du travail et mettre en valeur son CV</li>
</ul>


<p>Et aussi</p>

<ul>
<li><a href="http://www.dmoz.org/Computers/Programming/Contests/">Annuaire</a></li>
<li><a href="http://en.wikipedia.org/wiki/Category:Programming_contests">Article wikipedia</a></li>
</ul>


<h2>Cryptologie</h2>

<p>Il existe aussi des concours pour apprendre de la cryptologie</p>

<ul>
<li><a href="https://www.mysterytwisterc3.org/en/">Mystery Twister</a></li>
<li><a href="http://cryptopals.com/">Matasano Challenge</a></li>
</ul>


<h2>Divers</h2>

<ul>
<li><a href="https://github.com/veltman/clmystery">The Command Line Murders</a> résoudre un crime avec la ligne de commande..</li>
<li><a href="https://github.com/git-game/git-game">Git game</a> Un jeu de piste en git.

<h2>Conclusion</h2></li>
</ul>


<p>Je vous laisse j&#8217;ai un crime à résoudre.. Il y a de quoi s&#8217;occuper.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Haskell : Stack]]></title>
    <link href="http://mcamuzat.github.io/blog/2015/12/27/haskell-stack/"/>
    <updated>2015-12-27T18:39:17+01:00</updated>
    <id>http://mcamuzat.github.io/blog/2015/12/27/haskell-stack</id>
    <content type="html"><![CDATA[<h2>Introduction</h2>

<p>Je ne développe pas en <a href="https://www.haskell.org/">Haskell</a> mais je regarde beaucoup. La série que j&#8217;écris sur la programmation fonctionnelle me force à regarder le langage de plus près. Le monde haskell s&#8217;est enrichi d&#8217;un nouvel outil <strong>Stack</strong>.</p>

<h2>Stack et Haskell</h2>

<p>Stack est un logiciel qui gère l&#8217;installation/les packages/la création/le build/les tests d&#8217;un projet Haskell.</p>

<p>Il a plusieurs avantages:</p>

<ul>
<li>Il a été pensé pour automatiser le build.</li>
<li>Il a une ligne de commande sympathique que nous allons voir par la suite.</li>
<li>Il utilise un fichier <code>stack.yml</code> c&#8217;est l&#8217;équivalent d&#8217;un <code>composer.json</code> en php ou un <code>package.json</code> en node.</li>
<li>Tout est installé dans le <code>~/.stack</code> tout les programmes sont <em>isolés</em> et n&#8217;interfèrent pas avec les autres logiciels déjà pré installés.</li>
</ul>


<!--more-->


<h2>Mise en place.</h2>

<p>Il suffit d&#8217;ajouter les clés/et le dépôt sous ubuntu :  <a href="http://docs.haskellstack.org/en/stable/README.html#how-to-install">voir la documentation</a>
Une fois que le logiciel est installé</p>

<h3>Etape 1 : structure d&#8217;un projet.</h3>

<pre><code class="">$ stack new my-project
</code></pre>

<p>crée une arborescence toute faite</p>

<pre><code>.
├── LICENSE
├── Setup.hs
├── app
│   └── Main.hs
├── my-project.cabal
├── src
│   └── Lib.hs
├── stack.yaml
└── test
    └── Spec.hs

    3 directories, 7 files
</code></pre>

<p>A noter qu&#8217;il existe des templates d&#8217;applications (Un peu comme <a href="http://yeoman.io/">Yeoman</a>)</p>

<p>Par exemple pour créer une application Yesod (Pour faire un serveur web) et Mysql</p>

<pre><code>$ stack new mon-projet yesod-mysql
</code></pre>

<p>Pour lister les différents templates
<code>
$ stack templates
chrisdone
...
...
yesod-minimal
yesod-mongo
yesod-mysql
yesod-postgres
yesod-postgres-fay
yesod-simple
yesod-sqlite
</code></p>

<h2>Etape 2 : Installation des librairies</h2>

<pre><code>$ cd mon-projet
$ stack setup
</code></pre>

<p>Si Haskell n&#8217;est pas encore installé dans <code>~/.stack</code>, le logiciel s&#8217;occupe de tout, il installe aussi toutes les dépendances.</p>

<h2>Etape 3 : build et compilation</h2>

<pre><code>$ stack build
</code></pre>

<p>Le haskell est un language compilé. Le logiciel compile tout le projet.</p>

<h2>Etape 4 : Lancer le programme</h2>

<p>Pour lancer le programme</p>

<pre><code>$ stack exec mon-projet
</code></pre>

<p>Pour lancer les tests. Tout les projets viennents avec des tests
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ stack test&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;
</span><span class='line'>## Etape 5 : Installer le programme
</span><span class='line'>un peu comme un `make install` 
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;$ stack install</span></code></pre></td></tr></table></div></figure></p>

<h2>Etape 6 : Docker</h2>

<p>Docker c&#8217;est cool et pratique.</p>

<p>dans le <code>stack.yml</code>
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&hellip;
</span><span class='line'>&hellip;
</span><span class='line'>image:
</span><span class='line'>  container:
</span><span class='line'>    # Image de base
</span><span class='line'>    base: &ldquo;fpco/ubuntu-with-libgmp:14.04&rdquo;
</span><span class='line'>    # Noms de l'iso.
</span><span class='line'>    name: &ldquo;mcamuzat/mon-projet&rdquo;
</span><span class='line'>    # Nom du programme à lancer
</span><span class='line'>    entrypoints:
</span><span class='line'>      - mon-projet&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;
</span><span class='line'>Si l'image de base existe déjà
</span><span class='line'>
</span><span class='line'>Alors
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;$ stack image container</span></code></pre></td></tr></table></div></figure></p>

<p>Cela génère le container.</p>

<p>Il ne reste plus qu&#8217;à lancer le container
<code>
sudo docker run -t -i mcamuzat/mon-projet mon-projet
</code></p>

<h2>Listes de commandes</h2>

<ul>
<li><code>stack new nom-du-projet nom-du-template</code> crée un nouveau projet</li>
<li><code>stack setup</code> mise en place du projet</li>
<li><code>stack build</code> compile le projet</li>
<li><code>stack exec nom-du-programme</code> lance le programme</li>
<li><code>stack repl</code> Lance le mode interactif</li>
<li><code>stack test</code> Lance les tests</li>
<li><code>stack install</code> installe le programme.</li>
<li><code>stack templates</code> liste tout les templates.</li>
</ul>


<h2>Conclusion</h2>

<p>Je me mets au Haskell. C&#8217;est assez passionnant. Le langage n&#8217;est pas simple (je me casse un peu les dents dessus). Je suis pour l&#8217;instant juste sur les premiers problèmes de <a href="http://www.codewars.com/">codewars</a>. J&#8217;espère faire des post sur haskell par la suite. Il y a déja plein de tutoriels.</p>

<h2>Liens</h2>

<ul>
<li><a href="http://docs.haskellstack.org/en/stable/README.html">Le site officiel</a></li>
<li><a href="http://conscientiousprogrammer.com/blog/2015/11/30/haskell-tidbits-24-days-of-hackage-2015-day-1-introduction-and-stack/">Une introduction en anglais</a></li>
<li><a href="http://www.stephendiehl.com/posts/haskell_2016.html">Un second article an anglais</a></li>
<li><a href="https://www.fpcomplete.com/blog/2015/11/kubernetes">Créer le container Docker</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Les monades 5: les applicatives]]></title>
    <link href="http://mcamuzat.github.io/blog/2015/12/20/les-monades-5-les-applicatives/"/>
    <updated>2015-12-20T15:49:14+01:00</updated>
    <id>http://mcamuzat.github.io/blog/2015/12/20/les-monades-5-les-applicatives</id>
    <content type="html"><![CDATA[<p>Nous allons voir les foncteurs applicatifs.</p>

<p>Reprenons le container Maybe</p>

<p><img class="center" src="/images/applicative.png" width="428" height="212" title="&lsquo;Avec évaluation partielle&rsquo; &lsquo;avec évaluation partielle&rsquo;" ></p>

<p>Ce que j&#8217;aimerai c&#8217;est pouvoir faire ce genre d&#8217;opération</p>

<pre><code class="php">Maybe(3) + Maybe(3) = Maybe(6)
Container(4) * Container(5) = Container(40)
str_repeat(Maybe(".oOo"), Maybe("3")) = Maybe(".oOo.oOo.oOo");
</code></pre>

<p>La bonne nouvelle c&#8217;est que c&#8217;est possible.</p>

<!--more-->


<p>J&#8217;ai besoin de 2 étapes:</p>

<ul>
<li>Nous allons mettre en place la librairie <a href="https://github.com/widmogrod/php-functional">php-functionnal</a>. Il devient difficile d&#8217;utiliser sa propre librairie.</li>
<li>Nous avons besoin d&#8217;une nouvelle opération <code>ap</code> pour applicative.</li>
</ul>


<h2>installation de php-functionnal</h2>

<p>Grâce à composer c&#8217;est très simple.</p>

<pre><code class="">composer require widmogrod/php-functional
</code></pre>

<p>Voici le fichier php dans la racine du projet
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="o">?</span><span class="nx">php</span>
</span><span class='line'><span class="k">require_once</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">DIR</span><span class="o">&lt;/</span><span class="nx">strong</span><span class="o">&gt;</span> <span class="o">.</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">/</span><span class="nx">vendor</span><span class="o">/</span><span class="nx">autoload</span><span class="o">.</span><span class="nx">php</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span> <span class="c1">// Autoload files using Composer autoload&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="k">use</span> <span class="nx">Monad\Maybe</span><span class="p">;</span>
</span><span class='line'><span class="k">use</span> <span class="nx">Functional</span> <span class="k">as</span> <span class="nx">f</span><span class="p">;</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nv">$a</span> <span class="o">=</span> <span class="nx">Maybe\Just</span><span class="o">::</span><span class="na">of</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="nv">$b</span> <span class="o">=</span> <span class="nv">$a</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nv">$a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;});</span>
</span><span class='line'><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Si vous obtenez ceci
<code>php
class Monad\Maybe\Just#4 (1) {
  protected $value =&gt;
  int(2)
}
</code></p>

<p>Tout va bien!!</p>

<p>Je n&#8217;ai pas utilisé les mêmes noms que la librairie voici les traductions</p>

<ul>
<li>Container -> Identity</li>
<li>Collection -> Collection</li>
<li>Some -> Just</li>
<li>Nothing -> Nothing</li>
<li><code>Maybe\just(10)</code> est un helper <code>Maybe\Just::of(10)</code></li>
<li><code>Maybe\nothing()</code> -> <code>Maybe\Nothing::of(10)</code></li>
</ul>


<p>Nous allons faire quelque chose de curieux puisque nous ne mettons pas une valeur dans notre Maybe mais une fonction !</p>

<p>Regardons un exemple simple</p>

<pre><code class="php">$addOne = new Maybe\just(function($a) { return $a + 1;});
$value = new Maybe\just(5);
$result = $addOne-&gt;ap($value);

var_dump($result);
</code></pre>

<p>Dans le premier Maybe on a mis une fonction. <code>ap</code> prend en entrée un Maybe.</p>

<p>Nous obtenons
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">class</span> <span class="nc">Monad\Maybe\Just</span><span class="c1">#5 (1) {</span>
</span><span class='line'>  <span class="k">protected</span> <span class="nv">$value</span> <span class="o">=&gt;</span>
</span><span class='line'>  <span class="nx">int</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span>
</span><span class='line'><span class="nx">Essayons</span> <span class="nx">avec</span> <span class="sb">`Nothing`</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nv">$addOne</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Maybe\just</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;});</span>
</span><span class='line'><span class="nv">$value</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Maybe\nothing</span><span class="p">();</span>
</span><span class='line'><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$addOne</span><span class="o">-&gt;</span><span class="na">ap</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Le résultat
<code>php
class Monad\Maybe\Nothing#4 (0) {
}
</code></p>

<p>Cela ne semble pas très utiles</p>

<p>Nous allons utiliser notre fonction <code>curryN</code> du <a href="">post précédent</a>.</p>

<pre><code class="php">function add($a, $b)
{
    return $a + $b;
}

$add = Maybe\just(f\curryN(2, "add"));

$result = $add-&gt;ap(MayBe\just(5))-&gt;ap(Maybe\just(5));

// just(10)
</code></pre>

<ul>
<li>la fonction add est une addition et prend deux arguments. <code>(? + ?)</code></li>
<li>Je la transforme en évaluation partielle avec CurryN() et je la place dans un <code>just(? + ?)</code></li>
<li>Au premier <code>ap</code> je soumet le premier argument, il manque encore un argument , la fonction devient <code>just( 5 + ?)</code>.</li>
<li>Au second <code>ap</code> l&#8217;argument manquant est fournis. La fonction est complète <code>just( 5 + 5)</code> -> <code>just(10)</code>.</li>
</ul>


<p>La recette est simple, Je mets la fonction à plusieurs arguments dans mon Maybe avec le curryN. et j&#8217;applique chacun des arguments.</p>

<p>En fait si on fait une image</p>

<p><img class="center" src="/images/applicative.png" width="428" height="212" title="&lsquo;Avec évaluation partielle&rsquo; &lsquo;avec évaluation partielle&rsquo;" ></p>

<p>Mais nous pouvons faire cela avec toutes les fonctions</p>

<pre><code>$superStrRepeat = Maybe\just(f\curryN(2, "str_repeat"));

//alors 
var_dump(
   $superStrRepeat-&gt;ap(Maybe\just(".o0o"))-&gt;ap(Maybe\just(3))
);
//Maybe\just(".oOo.oOo.oOo");
var_dump(
   $superStrRepeat-&gt;ap(Maybe\nothing())-&gt;ap(Maybe\just(3))
);
//Maybe\Nothing();
var_dump(
   $superStrRepeat-&gt;ap(Maybe\nothing())-&gt;ap(Maybe\nothing()))
);
// Maybe\Nothing
</code></pre>

<p>C&#8217;est pratique car nous pouvons maintenant appliquer des fonctions à plusieurs arguments. et des fonctions qui ne travaillent pas avec des object Maybe, Nothing.</p>

<p>Quand on &ldquo;augmente&rdquo; les fonctions pour travailler avec d&#8217;autre types,  on appelle cela le <code>Lift</code></p>

<p>D&#8217;ailleurs cela s&#8217;exprime en 1 ligne avec la librairie</p>

<pre><code class="php">var_dump(f\liftA2("add", MayBe\just(5), Maybe\just(5)));
// Maybe\Just(10)

var_dump(f\liftA2("str_repeat",MayBe\just(".o0o"), Maybe\just(5)));
// Maybe\just(".o0o.o0o.o0o.o0o.o0o")
</code></pre>

<p><img class="center" src="/images/str_repeataveccontainer.png" width="517" height="425" title="&lsquo;On utilise la fonction LiftA2&rsquo; &lsquo;&rsquo;" ></p>

<h2>Pour résumer.</h2>

<ul>
<li>Les <em>functors</em> implémentent la fonction <code>map</code> qui prend en entrée une fonction.</li>
<li>Les <em>applicatives</em> implémentent la fonction <code>ap</code> prend en entrée un applicative. Cela permet d&#8217;appliquer des fonctions à plusieurs arguments.</li>
<li>Les <em>monades</em> implémentent la fonction <code>bind</code> qui prend entrée une fonction <em>monadique</em> c&#8217;est à dire qui renvoie une Nomade.</li>
</ul>


<p>Tous les monades que j&#8217;ai présenté implémentent les 3 fonctions (Maybe, Collection, Identity(Container)).</p>

<h2>En conclusion.</h2>

<p>Dans le prochain Post nous allons voir le cas particulier de <code>ap</code> pour les collections.</p>

<ul>
<li>Partie 1 : <a href="/blog/2015/11/11/les-monades-en-php-cest-possible-dot/">Monade/Functor</a></li>
<li>Partie 2 : <a href="/blog/2015/11/15/les-monades-suite-le-functor-maybe-dot/">Le functor Maybe</a></li>
<li>Partie 3 : <a href="/blog/2015/11/22/les-monades-3-le-maybe-suite/">Le functor Maybe avec le Bind</a></li>
<li>Partie 4 : <a href="/blog/2015/11/29/les-monades-les-listes/">Les listes</a></li>
<li>Interlude : <a href="/blog/2015/12/06/les-monades-evaluation-partielle/">Les évaluations partielles</a></li>
<li>Partie 5 : <a href="2015/12/20/les-monades-5-les-applicatives/">Les applicatives</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Les Monades : Evaluation partielle]]></title>
    <link href="http://mcamuzat.github.io/blog/2015/12/06/les-monades-evaluation-partielle/"/>
    <updated>2015-12-06T18:49:49+01:00</updated>
    <id>http://mcamuzat.github.io/blog/2015/12/06/les-monades-evaluation-partielle</id>
    <content type="html"><![CDATA[<h2>Interlude.</h2>

<p>J&#8217;ai besoin pour le prochain chapitre d&#8217;introduire la notion d&#8217;application partielle. Cela consiste à évaluer une partie de la fonction même si je n&#8217;ai pas tous les arguments.</p>

<p>Soit la fonction suivante.</p>

<pre><code class="php">function plus($a, $b) {
   return $a + $b;
}
</code></pre>

<p>Que donne l&#8217;exécution ?
<code>php
$result = plus(10);
</code></p>

<!--more-->


<p>Une erreur bien entendu, puisque il manque un argument..</p>

<p>Voici une fonction tirée de la librairie <a href="https://github.com/widmogrod/php-functional">php-functionnal</a></p>

<pre><code class="php">function push(array $array, array $values)
{
    foreach ($values as $value) {
        $array[] = $value;
    }
    return $array;
}

function curryN($numberOfArguments, callable $function, array $args = [])
{
    return function () use ($numberOfArguments, $function, $args) {
        $argsLeft = $numberOfArguments - func_num_args();
        return $argsLeft &lt;= 0
            ? call_user_func_array($function, push($args, func_get_args()))
            : curryN($argsLeft, $function, push($args, func_get_args()));
    };
}
</code></pre>

<p>Et maintenant reprenons ma première fonction
<code>php
$add = curryN(2, function($a, $b) {return $a + $b;});
</code></p>

<p>Maintenant réessayons notre commande</p>

<pre><code class="php">$add10 = $add(10);
</code></pre>

<p>Je n&#8217;ai pas d&#8217;erreur mais il y a mieux !</p>

<pre><code class="php">$result = $add10(10) // 20.
</code></pre>

<p>Varions encore un peu avec aucun argument</p>

<pre><code class="php">$addition = $add();
result = $addition(10,10);//20
</code></pre>

<p>S&#8217;il manque un argument, la fonction ne renvoie pas de résultat mais une nouvelle fonction.</p>

<p>On appelle cela l&#8217;évaluation partielle.</p>

<p>C&#8217;est plutôt pratique..</p>

<h2>Quelques applications pratiques</h2>

<h3>On réutilise mieux les calculs.</h3>

<p>Par exemple
<code>
$result1 = $valeurTresComplique + $valeursTresSimple1;
$result2 = $valeurTresComplique + $valeursTresSimple2;
</code></p>

<p>Devient
<code>
$partiel = $add($valeurTresComplique);
$result1 = $partiel($valeursTresSimple1);
$result2 = $partiel($valeursTresSimple2);
</code></p>

<h3>C&#8217;est plus simple à tester.</h3>

<p>Si toute les fonctions ne prennent qu&#8217;un argument, Il y a moins de cas à tester.
De plus cela permet une meilleure isolation du code. Une fonction à 5-6 arguments est rarement un bon signe dans le code.</p>

<h3>Cela permet de chainer les fonctions.</h3>

<p>Nous allons nous servir de cette astuce pour nos monades/functors. Depuis le début on ne peux mettre qu&#8217;une seule valeur dans mon <em>container</em> donc comment faire pour faire des fonctions à plusieurs arguments ?</p>

<h2>Les évaluations partielles</h2>

<p>Il faut quand même noter que le langage PHP n&#8217;est pas génial pour le coup.</p>

<p>L&#8217;expression suivante en javascript est parfaitement légale.
<code>js
result = add(10)(5);
</code>
je suis obligé d&#8217;utiliser une variable intermédiaire en PHP.
<code>php
$add10= add(10);
$result = $add10(5);
</code>
Bref la syntaxe n&#8217;est pas très pratique.</p>

<h2>Conclusion</h2>

<p>En Haskell et <a href="https://fr.wikipedia.org/wiki/OCaml">OCaml</a> l&#8217;évaluation partielle est la norme.
<code>haskell
max 10 10
</code>
En fait le langage fait.
<code>haskell
(max 10) 10
</code></p>

<p>Transformer une fonction à plusieurs arguments en une série de fonction à un argument s&#8217;appelle la <em>Curryfication</em>. Cela vient du prénom de la première personne a avoir écris sur le sujet <a href="https://fr.wikipedia.org/wiki/Haskell_Curry">Haskell Curry</a>. Le nom de famille doit voir dire quelque chose aussi..</p>

<p>Cela semble un peu compliqué et pas forcement intéressant sur les exemples que j&#8217;ai choisi. Mais dans le prochain post nous allons utiliser cette notion.</p>

<p>Merci de m&#8217;avoir lu.</p>

<ul>
<li>Partie 1 : <a href="/blog/2015/11/11/les-monades-en-php-cest-possible-dot/">Monade/Functor</a></li>
<li>Partie 2 : <a href="/blog/2015/11/15/les-monades-suite-le-functor-maybe-dot/">Le functor Maybe</a></li>
<li>Partie 3 : <a href="/blog/2015/11/22/les-monades-3-le-maybe-suite/">Le functor Maybe avec le Bind</a></li>
<li>Partie 4 : <a href="/blog/2015/11/29/les-monades-les-listes/">Les listes</a></li>
<li>Interlude : <a href="/blog/2015/12/06/les-monades-evaluation-partielle/">Les évaluations partielles</a></li>
<li>Partie 5 : <a href="2015/12/20/les-monades-5-les-applicatives/">Les applicative</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Les Monades : Les listes]]></title>
    <link href="http://mcamuzat.github.io/blog/2015/11/29/les-monades-les-listes/"/>
    <updated>2015-11-29T21:44:52+01:00</updated>
    <id>http://mcamuzat.github.io/blog/2015/11/29/les-monades-les-listes</id>
    <content type="html"><![CDATA[<p>Nous continuons notre exploration des Monades/Functors, nous allons parler de Collection, de lapins, de marteaux et de non-déterminisme.</p>

<p>Voici notre nouveau <em>container</em> Le container <strong>List</strong>. Il prend en entrée un tableau (Array) ou en Php un <code>Traversable</code>.
<img class="center" src="/images/collection.png" width="600" height="450" title="&lsquo;Le container Collection&rsquo; &lsquo;Le container collection&rsquo;" ></p>

<p>Nous allons voir ensemble les listes, Collections. Nous allons voir le <code>map</code>, le <code>bind</code> nous allons voir que le comportement n&#8217;est pas exactement le même..</p>

<!--more-->


<p>Ne nous embêtons pas allons directement dans l&#8217;implémentation.</p>

<pre><code class="php">class Collection extends Container{
    /**
     * @param array $value
     */
    public function __construct($value)
    {

        $this-&gt;value = $this-&gt;isNativeTraversable($value)
            ? $value
            : [$value];
    }

    private function isNativeTraversable($value)
    {
        return is_array($value) || $value instanceof \Traversable;
    }

    public function map(callable $transformation)
    {
        $result = [];
        foreach ($this-&gt;value as $key =&gt; $value) {
            $result[$key] = call_user_func($transformation, $value);
        }
        return self::of($result);
    }

    public function extract() {
        $result = array();
        foreach ($this-&gt;value as $value) {
            if ($value instanceof Container) {
                $result[] = $value-&gt;extract();
            } else {
                $result[] = $value;
            }
        }
        return $result;
    }

}
</code></pre>

<p>On garde toujours la même définition. <code>map</code> prend toujours une fonction et renvoie un Objet du même type. <code>extract</code> renvoie la valeur, <code>Collection::of</code> renvoie une collection.</p>

<p>Quelques exemples
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="nb">var_dump</span><span class="p">(</span>
</span><span class='line'>   <span class="nx">Collection</span><span class="o">::</span><span class="na">of</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</span><span class='line'>     <span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">value</span><span class="p">;})</span>
</span><span class='line'>     <span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nv">$value</span><span class="o">-</span><span class="mi">1</span><span class="p">;})</span>
</span><span class='line'>     <span class="o">-&gt;</span><span class="na">extract</span><span class="p">()</span>
</span><span class='line'><span class="p">);</span> <span class="c1">// [ 1, 3, 5, 7]&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nb">var_dump</span><span class="p">(</span><span class="nx">Collection</span><span class="o">::</span><span class="na">of</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">one</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">two</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">three</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;))</span>
</span><span class='line'>     <span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nb">strtoupper</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;)</span>
</span><span class='line'>     <span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$value</span><span class="o">.&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="o">!!!!&amp;</span><span class="nx">rdquo</span><span class="p">;;})</span>
</span><span class='line'>     <span class="o">-&gt;</span><span class="na">extract</span><span class="p">()</span>
</span><span class='line'><span class="p">);</span><span class="c1">// [&amp;ldquo;ONE!!!!&amp;rdquo;, &amp;ldquo;TWO!!!!&amp;rdquo;,&amp;ldquo;THREE!!!!&amp;rdquo;]&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span>
</span><span class='line'><span class="nx">Nous</span> <span class="nx">allons</span> <span class="nx">reprendre</span> <span class="nx">notre</span> <span class="nx">liste</span> <span class="nx">du</span> <span class="nx">post</span> <span class="p">[</span><span class="nx">précédent</span><span class="p">](</span><span class="nx">blog</span><span class="o">/</span><span class="mi">2015</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">22</span><span class="o">/</span><span class="nx">les</span><span class="o">-</span><span class="nx">monades</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="nx">le</span><span class="o">-</span><span class="nx">maybe</span><span class="o">-</span><span class="nx">suite</span><span class="o">/</span><span class="p">)</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nv">$data</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">id_article</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">titre</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">titre1</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">meta</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">images</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="c1">//first.jpg&amp;rsquo;, &amp;lsquo;//second.jpg&amp;rsquo;]]],</span>
</span><span class='line'>    <span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">id_article</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">titre</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">titre2</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;,</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">meta</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">images</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="c1">//third.jpg&amp;rsquo;]]],</span>
</span><span class='line'>    <span class="p">[</span><span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">id_article</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">titre</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="nx">titre3</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;],</span>
</span><span class='line'><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>
<img class="center" src="/images/arraydanscontainer.png" width="600" height="450" title="&lsquo;Un array dans le container&rsquo; &lsquo;Un array dans le container&rsquo;" ></p>

<ul>
<li>Nous allons transformer chaque ligne en <code>maybe</code> grâce à l&#8217;instruction <code>maybeFromValue</code> (<a href="blog/2015/11/15/les-monades-suite-le-functor-maybe-dot/">post2</a>)</li>
</ul>


<p><img class="center" src="/images/collectionmaybe.png" width="600" height="450" title="&lsquo;Un array dans le container&rsquo; &lsquo;Un array dans le container&rsquo;" ></p>

<p>Nous aimerions utiliser notre instruction <code>get</code>.</p>

<p>l&#8217;algo :</p>

<ul>
<li>je récupère le maybe.</li>
<li>J&#8217;appelle la fonction bind du maybe avec le get</li>
</ul>


<p>Cela donne ..</p>

<pre><code class="php">function get($key)
{
    return function ($value) use ($key) {
        return $value-&gt;bind(function ($array) use ($key) {
            return isset($array[$key]) ? Some::of($array[$key]) : Nothing::of(null);
        });
    };
}
</code></pre>

<p>Oui vous ne rêvez pas c&#8217;est une fonction qui renvoie une fonction qui renvoie une fonction.</p>

<p>L&#8217;implémentation est sympathique..</p>

<pre><code class="php">$result = Collection:of($data)
   -&gt;map(fromValue)
   -&gt;bind(get("meta"))
   -&gt;bind(get("images"))
   -&gt;bind(get(0))
   -&gt;extract();
</code></pre>

<p>Nous obtenons en une ligne <em>sans if sans condition</em>.</p>

<pre><code class="php">["//first.jpg", "//third.jpg", null]
</code></pre>

<h2>Le bind</h2>

<p>Je n&#8217;ai pas donnée le code du bind qui se résume à</p>

<pre><code class="php">    public function bind(callable $transformation)
    {
        return self::of($this-&gt;concat($this-&gt;map($transformation)));
    }
</code></pre>

<p>Je vais essayer de justifier tout cela.</p>

<p>Partons d&#8217;abord du principe que <code>$this-&gt;concat</code> n&#8217;existe pas..</p>

<p>Donc mon <code>bind</code> devient</p>

<pre><code class="php">    public function bind(callable $transformation)
    {
        return self::of($this-&gt;map($transformation));
    }
</code></pre>

<p>Un exemple
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">addOne</span><span class="p">(</span><span class="nv">$input</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">Collection</span><span class="o">::</span><span class="na">of</span><span class="p">(</span><span class="nv">$input</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nv">$result</span> <span class="o">=</span> <span class="nx">Collection</span><span class="o">::</span><span class="na">of</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="nx">addOne</span><span class="p">);</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Le résultat
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">class</span> <span class="nc">Collection</span><span class="c1">#6 (1) {</span>
</span><span class='line'>  <span class="k">protected</span> <span class="nv">$value</span> <span class="o">=&gt;</span>
</span><span class='line'>  <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span>
</span><span class='line'>    <span class="k">class</span> <span class="nc">Collection</span><span class="c1">#5 (1) {</span>
</span><span class='line'>      <span class="k">protected</span> <span class="nv">$value</span> <span class="o">=&gt;</span>
</span><span class='line'>      <span class="k">array</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span>
</span><span class='line'>        <span class="k">class</span> <span class="nc">Collection</span><span class="c1">#2 (1) {</span>
</span><span class='line'>          <span class="o">&amp;</span><span class="nx">hellip</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span>
</span><span class='line'>        <span class="k">class</span> <span class="nc">Collection</span><span class="c1">#3 (1) {</span>
</span><span class='line'>          <span class="o">&amp;</span><span class="nx">hellip</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span>
</span><span class='line'>        <span class="k">class</span> <span class="nc">Collection</span><span class="c1">#4 (1) {</span>
</span><span class='line'>          <span class="o">&amp;</span><span class="nx">hellip</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span>
</span><span class='line'><span class="nx">Nous</span> <span class="nx">avons</span> <span class="nx">une</span> <span class="nx">collection</span> <span class="nx">qui</span> <span class="nx">contient</span> <span class="nx">une</span> <span class="nx">collection</span> <span class="p">(</span><span class="nx">double</span> <span class="nx">container</span><span class="o">!!</span><span class="p">)</span> <span class="nx">et</span> <span class="nx">pire</span> <span class="nx">dans</span> <span class="nx">chaque</span> <span class="nx">valeur</span> <span class="nx">est</span> <span class="nx">encore</span> <span class="nx">une</span> <span class="nx">collection</span> <span class="o">!.</span> <span class="nx">On</span> <span class="nx">perd</span> <span class="nx">aussi</span> <span class="nx">le</span> <span class="nx">chainage</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Bref</span> <span class="nx">nous</span> <span class="nx">avons</span> <span class="nx">tout</span> <span class="nx">perdu</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">### Solution le marteau.</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span><span class="o">%</span> <span class="nx">img</span> <span class="nx">center</span> <span class="o">/</span><span class="nx">images</span><span class="o">/</span><span class="nx">marteau</span><span class="o">.</span><span class="nx">png</span> <span class="mi">515</span> <span class="mi">150</span> <span class="s1">&#39;Le marteau comme solution.&#39;</span> <span class="s1">&#39;Le marteau comme solution&#39;</span> <span class="o">%</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Nous</span> <span class="nx">allons</span> <span class="nx">aplatir</span> <span class="nx">le</span> <span class="nx">résultat</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="nx">C</span><span class="s1">&#39;est a dire que nous allons transformer notre collection `[[a],[b],[c]]` en `[a, b, c]`</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Voici l&#39;</span><span class="nx">implémentation</span> <span class="nx">en</span> <span class="nx">code</span><span class="o">..</span> <span class="nx">C</span><span class="s1">&#39;est un peu long n&#39;</span><span class="nx">hésitez</span> <span class="nx">pas</span> <span class="nx">à</span> <span class="nx">sauter</span> <span class="nx">cette</span> <span class="nx">partie</span><span class="o">..</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Partons</span> <span class="nx">du</span> <span class="nx">principe</span> <span class="nx">que</span> <span class="nx">c</span><span class="err">&#39;</span><span class="nx">est</span> <span class="nx">un</span> <span class="k">array</span><span class="o">..</span>
</span><span class='line'>
</span><span class='line'><span class="nx">On</span> <span class="nx">aplati</span> <span class="nx">notre</span> <span class="nx">liste</span> <span class="nx">ainsi</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;/</span><span class="nx">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nv">$flatten</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">a</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;,</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">d</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;),</span> <span class="k">array</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">b</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;),</span> <span class="k">array</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">ldquo</span><span class="p">;</span><span class="nx">c</span><span class="o">&amp;</span><span class="nx">rdquo</span><span class="p">;));</span>
</span><span class='line'><span class="nv">$result</span><span class="p">;</span>
</span><span class='line'><span class="k">foreach</span><span class="p">(</span><span class="nv">$flatten</span> <span class="k">as</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">foreach</span><span class="p">(</span><span class="nv">$value</span> <span class="k">as</span> <span class="nv">$subvalue</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$result</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$subvalue</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nb">var_dump</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span> <span class="c1">//array(&amp;ldquo;a&amp;rdquo;, &amp;ldquo;d&amp;rdquo;, &amp;ldquo;b&amp;rdquo;, &amp;ldquo;c&amp;rdquo;);</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Le problème est que notre collection n&#8217;est pas un <code>Array</code>.. Mais essayons avec une fonction un peu plus tordue</p>

<pre><code class="php">$result = array_reduce(
    $flatten,
    function ($acc, $value){
    array_reduce($value, function($idontcare, $value) use(&amp;$acc) {
        $acc[] = $value;
    });
    return $acc;
}, []);
</code></pre>

<p>C&#8217;est un façon un peu plus complexe d&#8217;exprimer la même chose que le code plus haut. Sans utiliser les boucles <code>foreach</code>.</p>

<p>Le reduce pour notre collection est facilement exprimable.</p>

<pre><code class="php">    // dans la classe Collection
     public function reduce(callable $function, $accumulator)
    {
        foreach ($this-&gt;value as $item) {
            $accumulator = call_user_func($function, $accumulator, $item);
        }
        return $accumulator;
    }
</code></pre>

<p>Reprenons le code du <code>array_reduce</code> et utilisons notre <code>reduce</code></p>

<pre><code class="php"> // dans la classe Collection
    private function concat(Collection $collection)
    {
        return $collection-&gt;reduce(function ($agg, $value) {
            $value = ($value instanceof Collection) ? $value : Collection::of($value);
            return $value-&gt;reduce(function($agg, $v) {
                $agg[] = $v;
                return $agg;
            }, $agg);
        }, []);
    }
</code></pre>

<p>Voici comment on aplatit notre fonction et on sauvegarde le chainage. Mais il y a mieux..</p>

<h2>Si j&#8217;avais un marteau..</h2>

<p>Montrons quelque exemples de bind.</p>

<h3>Exemple 1 : Les lapins.</h3>

<p>Soit le fonction suivante</p>

<pre><code class="php ">function reproduction($input) {
       return Collection::of(array($input, $input, $input);
}
</code></pre>

<p>Un exemple</p>

<pre><code>$lapin = Collection::of(array("lapin"))
    -&gt;bind("reproduction")
    -&gt;bind("reproduction")
    -&gt;extract();
</code></pre>

<p>Le résultat</p>

<p><img class="center" src="/images/reproductionlapin.png" width="594" height="482" title="&lsquo;Un array dans le container&rsquo; &lsquo;Un array dans le container&rsquo;" ></p>

<ul>
<li>premier bind</li>
</ul>


<pre><code class="php">["lapin"] -&gt; map -&gt;[["lapin", "lapin","lapin"]] -&gt; concat -&gt; ["lapin", "lapin","lapin"]
</code></pre>

<ul>
<li>second bind</li>
</ul>


<pre><code class="php">["lapin", "lapin","lapin"] -&gt; map [["lapin","lapin","lapin"][..][..]] -&gt; ["lapin" .. *9]
</code></pre>

<p>Nous commençons avec un lapin, nous multiplions par 3 à chaque interaction. Comme la liste est aplatie à chaque fois.</p>

<h3>Exemple 2 : les fractales</h3>

<p>Soit la fonction suivante</p>

<pre><code class="php">
function fractale($value) {
    if ($value == "#")
        return (Collection::of(array('#', '_', '#')));
    return Collection::of(array("_", "_","_"));
}
$result = Collection::of(array("#"))-&gt;bind("fractale")-&gt;bind("fractale")-&gt;bind("fractale")-&gt;extract();
echo implode($result);
//#_#___#_#_________#_#___#_#
</code></pre>

<h3>Exemple 3 : avec les chiffres</h3>

<p>Soit la fonction suivante</p>

<p>La fonction inférieure à 20 renvoie un array vide.</p>

<pre><code class="php">function moiEtMonSuccesseur($input) {
    return Collection::of($input, $input+1); 
}

function inferieurA20($value) {
   if($value &gt; 20) {
        return Collection::of([]);
   }
   return (Collection::of(array($value)));
}

$result = Collection::of([10,20,30])-&gt;bind("moiEtMonSuccesseur")-&gt;bind("inferieurA20")-&gt;bind("moiEtMonSuccesseur")-&gt;extract();
</code></pre>

<ul>
<li>premier <code>bind</code></li>
</ul>


<pre><code class="php">[10,20, 30] -&gt; map -&gt; [[10,11],[20,21],[30,31]]-&gt;concat -&gt; [10, 11, 20, 21, 30, 31]
</code></pre>

<ul>
<li>second <code>bind</code></li>
</ul>


<pre><code class="php">[10, 11, 20, 21, 30, 31] -&gt; map -&gt; [[10],[11],[20],[],[],[]]-&gt; concat -&gt; [10,11,20]
</code></pre>

<ul>
<li>troisième <code>bind</code></li>
</ul>


<pre><code class="php">[10, 11, 20] -&gt; map [[10,11], [11,12], [20, 21]]-&gt; concat -&gt; [10,11,11,12,20,21]
</code></pre>

<h3>Exemple 4: Trouver les positions possibles d&#8217;un jeux de société</h3>

<pre><code class="php ">function donneTousLesCoupsPossibles($position) {
    //renvoie toutes les positions légales
    return Collection::of(array(position_possible..));
}

$postion1-&gt;bind(donneTousLesCoupsPossibles)
   -&gt;bind(donneTousLesCoupsPossibles);
</code></pre>

<p>cette fonction donne toute les parties possibles dans deux coup.</p>

<h2>Conclusion</h2>

<p>On comprend assez bien l&#8217;intérêt de cette monade pour gérer des listes, mais il y a une autre vision possible. La collection avec le bind est considérée comme une façon de gérer des entrées <em>non déterministes</em>. J&#8217;ai eu un peu de mal à comprendre, mais voici l&#8217;idée.
La valeur 3 n&#8217;a qu&#8217;une valeur qui est <code>3</code> facile, la valeur <code>[1, 2, 3]</code> est une représentation de la même valeur sauf qu&#8217;elle à trois états possible <code>1, 2, 3</code>. Grâce au <code>bind</code> je prend en compte tous les états possibles.</p>

<p>Pour résumer :</p>

<ul>
<li>Le Maybe prend le cas ou la valeur est présente.</li>
<li>La liste permet de gérer le Non-determinisme.</li>
</ul>


<p>Il reste encore beaucoup de chose à parler. Nous avons parlé des functors(<code>map</code> ou <code>fmap</code>), des monades (<code>of</code> et <code>bind</code>) nous allons voir les applicatives..</p>

<h1>des liens.</h1>

<ul>
<li>Ma référence pour l&#8217;implémentation est <a href="https://github.com/widmogrod/php-functional">php-functional</a>.</li>
<li>La bible pour le haskell est <a href="learnyouahaskell.com">Learn You a Haskell for Great Good!</a> Le livre est gratuit avec des jolis dessins. Enfin le fond et la forme sont vraiment bon.</li>
<li><p>Il existe en français !! <a href="http://lyah.haskell.fr/">Apprendre Haskell vous fera le plus grand bien !</a></p></li>
<li><p>Partie 1 : <a href="/blog/2015/11/11/les-monades-en-php-cest-possible-dot/">Monade/Functor</a></p></li>
<li>Partie 2 : <a href="/blog/2015/11/15/les-monades-suite-le-functor-maybe-dot/">Le functor Maybe</a></li>
<li>Partie 3 : <a href="/blog/2015/11/22/les-monades-3-le-maybe-suite/">Le functor Maybe avec le Bind</a></li>
<li>Partie 4 : <a href="/blog/2015/11/29/les-monades-les-listes/">Les listes</a></li>
<li>Interlude : <a href="/blog/2015/12/06/les-monades-evaluation-partielle/">Les évaluations partielles</a></li>
<li>Partie 5 : <a href="2015/12/20/les-monades-5-les-applicatives/">Les applicatives</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
